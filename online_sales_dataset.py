# -*- coding: utf-8 -*-
"""Online_Sales_Dataset

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ls_H9PIbDFnEPz5D2Pe1uekZ0nFHguIl
"""

import sqlite3
import pandas as pd

from google.colab import files
files.upload()

import os
print(os.listdir())

import pandas as pd

df = pd.read_csv('online_sales_dataset.csv')
df.head()

conn = sqlite3.connect(":memory:")
cursor = conn.cursor()

cursor.execute("""
CREATE TABLE sales (
    InvoiceNo TEXT,
    StockCode TEXT,
    Description TEXT,
    Quantity INTEGER,
    InvoiceDate TEXT,
    UnitPrice REAL,
    CustomerID INTEGER,
    Country TEXT
)
""")

conn.commit()

query = "SELECT * FROM sales LIMIT 5"
df_result = pd.read_sql_query(query, conn)
print(df_result)

cursor.executemany("""
INSERT INTO sales (InvoiceNo, StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID, Country)
VALUES (?, ?, ?, ?, ?, ?, ?, ?)
""", df_sales.values.tolist())

conn.commit()

query = "SELECT * FROM sales LIMIT 5"
df_result = pd.read_sql_query(query, conn)
print(df_result)

pd.read_sql_query("SELECT COUNT(DISTINCT InvoiceNo) AS Total_Invoices FROM sales", conn)

"""Total Quantity sold per country-"""

query1 = """
SELECT Country, SUM(Quantity) AS Total_Quantity
FROM sales
GROUP BY Country
ORDER BY Total_Quantity DESC
"""

df_country_qty = pd.read_sql_query(query1, conn)
print("üîπ Total Quantity Sold Per Country:")
print(df_country_qty)

"""Top 5 Best-Selling Products (by Quantity)-"""

query2 = """
SELECT Description, SUM(Quantity) AS Total_Sold
FROM sales
GROUP BY Description
ORDER BY Total_Sold DESC
LIMIT 5
"""

df_top_products = pd.read_sql_query(query2, conn)
print("\nüîπ Top 5 Best-Selling Products:")
print(df_top_products)

"""Top revenue per product-"""

query3 = """
SELECT Description, ROUND(SUM(Quantity * UnitPrice), 2) AS Total_Revenue
FROM sales
GROUP BY Description
ORDER BY Total_Revenue DESC
LIMIT 5
"""

df_top_revenue = pd.read_sql_query(query3, conn)
print("\nüîπ Top 5 Products by Revenue:")
print(df_top_revenue)

"""Count customers-"""

query4 = "SELECT COUNT(DISTINCT CustomerID) AS Unique_Customers FROM sales"
df_customers = pd.read_sql_query(query4, conn)
print("\nüîπ Number of Unique Customers:")
print(df_customers)

"""Sales by UK-"""

country = "United Kingdom"

query_country = f"""
SELECT * FROM sales
WHERE Country = '{country}'
"""

df_uk = pd.read_sql_query(query_country, conn)
print(f"üîπ Sales Records for {country}:")
print(df_uk.head())

import matplotlib.pyplot as plt
import seaborn as sns

sns.set(style="whitegrid")

"""Top 5 sales by country-"""

query_pie = """
SELECT Country, SUM(Quantity) AS TotalQuantity
FROM sales
GROUP BY Country
ORDER BY TotalQuantity DESC
LIMIT 5
"""

df_top_countries = pd.read_sql_query(query_pie, conn)

plt.figure(figsize=(6,6))
plt.pie(df_top_countries['TotalQuantity'], labels=df_top_countries['Country'], autopct='%1.1f%%', startangle=140)
plt.title("Top 5 Countries by Quantity Sold")
plt.axis('equal')
plt.show()

"""Daily Revnue-"""

query_revenue = """
SELECT DATE(InvoiceDate) AS SaleDate,
       ROUND(SUM(Quantity * UnitPrice), 2) AS DailyRevenue
FROM sales
GROUP BY SaleDate
ORDER BY SaleDate
"""

df_revenue = pd.read_sql_query(query_revenue, conn)
print("\nüîπ Daily Revenue:")
print(df_revenue.head())


plt.figure(figsize=(10, 5))
sns.lineplot(data=df_revenue, x="SaleDate", y="DailyRevenue", marker='o')
plt.xticks(rotation=45)
plt.title("Daily Revenue Over Time")
plt.xlabel("Date")
plt.ylabel("Revenue (¬£)")
plt.tight_layout()
plt.show()

df_revenue.to_csv("daily_revenue.csv", index=False)
print("‚úîÔ∏è Revenue data saved as daily_revenue.csv")

from google.colab import files
files.download("daily_revenue.csv")

